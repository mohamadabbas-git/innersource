<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Redirect Page</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f3f4f6;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0px 4px 20px rgba(0,0,0,0.1);
            width: 520px;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-size: 26px;
            font-weight: bold;
        }

        label {
            font-weight: bold;
            color: #333;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-top: 5px;
            margin-bottom: 20px;
            font-size: 15px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #444;
        }

        .checkbox-group {
            padding: 12px;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .checkbox-group label {
            font-weight: normal;
        }

        .toggle {
            cursor: pointer;
            color: #e84e0f;
            font-size: 13px;
            margin-left: 10px;
        }

        .sub-list {
            margin-top: 8px;
            margin-left: 25px;
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        button {
            width: 100%;
            padding: 12px;
            background: #e84e0f;
            border: none;
            color: white;
            font-size: 17px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
        }

        button:hover {
            background: #c73f0d;
        }
    </style>

</head>
<body>

    <div class="container">
        <h2>Business Redirect Form</h2>

        <form id="redirectForm">

            <label for="nameInput">Enter Name(s):</label>
            <input type="text" id="nameInput" placeholder="ex: chg,swi" required />

            <label for="revisionInput">Enter Revision (optional):</label>
            <input type="text" id="revisionInput" placeholder="ex: rel-AT6.26-std" />

            <div class="section-title">Select Options (optional):</div>

            <!-- FIRST 3 SPECIAL OPTIONS -->
            <div class="checkbox-group">
                <input type="checkbox" value="expose-profile" name="category" id="opt-exp">
                <label for="opt-exp">expose-profile</label><br>

                <input type="checkbox" value="depend" name="category" id="opt-dep">
                <label for="opt-dep">depend</label><br>

                <input type="checkbox" value="assembly-profile" name="category" id="opt-asm">
                <label for="opt-asm">assembly-profile</label><br>
            </div>

            <!-- COBOL MAIN -->
            <div class="checkbox-group">
                <input type="checkbox" value="COBOL" name="category" id="opt-cobol">
                <label for="opt-cobol">COBOL</label>
                <span class="toggle" onclick="toggleCobol()">[expand]</span>

                <!-- COBOL SUB LIST (values WITHOUT module prefix) -->
                <div id="cobol-sublist" class="sub-list">

                    <input type="checkbox" name="cobol-sub" value="service-xtr-cpy"> service-xtr-cpy<br>
                    <input type="checkbox" name="cobol-sub" value="service-xtr"> service-xtr<br>
                    <input type="checkbox" name="cobol-sub" value="service-mtr-cpy"> service-mtr-cpy<br>
                    <input type="checkbox" name="cobol-sub" value="service-mtr"> service-mtr<br>

                    <input type="checkbox" name="cobol-sub" value="service-legacy-cpy"> service-legacy-cpy<br>
                    <input type="checkbox" name="cobol-sub" value="service-legacy"> service-legacy<br>

                    <input type="checkbox" name="cobol-sub" value="printing-prtf-cpy"> printing-prtf-cpy<br>
                    <input type="checkbox" name="cobol-sub" value="printing-prtf"> printing-prtf<br>
                    <input type="checkbox" name="cobol-sub" value="printing-avis"> printing-avis<br>

                    <input type="checkbox" name="cobol-sub" value="dspf-ui"> dspf-ui<br>

                    <input type="checkbox" name="cobol-sub" value="database-dds-multi-cpy"> database-dds-multi-cpy<br>
                    <input type="checkbox" name="cobol-sub" value="database-dds-multi"> database-dds-multi<br>
                    <input type="checkbox" name="cobol-sub" value="database-dds-cpy"> database-dds-cpy<br>
                    <input type="checkbox" name="cobol-sub" value="database-dds"> database-dds<br>

                </div>
            </div>

            <!-- NORMAL OPTIONS -->
            <div class="checkbox-group">
                <input type="checkbox" value="X3S" name="category" id="opt-x3s">
                <label for="opt-x3s">X3S</label><br>

                <input type="checkbox" value="SDE" name="category" id="opt-sde">
                <label for="opt-sde">SDE</label><br>

                <input type="checkbox" value="X3NATIF" name="category" id="opt-x3natif">
                <label for="opt-x3natif">X3NATIF</label><br>
            </div>

            <button type="submit">Submit</button>

        </form>
    </div>


<script>
function toggleCobol() {
    const box = document.getElementById("cobol-sublist");
    box.style.display = box.style.display === "none" ? "block" : "none";
}

document.getElementById("redirectForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const nameInput = document.getElementById("nameInput").value.trim();
    const names = nameInput.split(",").map(n => n.trim()).filter(n => n !== "");

    const revisionValue = document.getElementById("revisionInput").value.trim();

    const categories = Array.from(
        document.querySelectorAll("input[name='category']:checked")
    ).map(cb => cb.value);

    const cobolSubs = Array.from(
        document.querySelectorAll("input[name='cobol-sub']:checked")
    ).map(cb => cb.value);

    if (names.length === 0) {
        alert("Please enter at least one module.");
        return;
    }

    const special = ["expose-profile", "depend", "assembly-profile"];

    names.forEach(nameValue => {

        // Base URL if no options
        if (categories.length === 0 && cobolSubs.length === 0) {
            const baseUrl = `https://innersource.soprasteria.com/sab-at/business/${nameValue}`;
            window.open(baseUrl, "_blank");
        }

        // Main category logic
        categories.forEach(option => {
            let url = "";

            if (special.includes(option)) {

                const tail = `${nameValue}-${option}`;

                if (revisionValue !== "") {
                    url = `https://innersource.soprasteria.com/sab-at/business/${nameValue}/mgmt/dep-mgmt/${tail}/-/tree/${revisionValue}?ref_type=heads`;
                } else {
                    url = `https://innersource.soprasteria.com/sab-at/business/${nameValue}/mgmt/dep-mgmt/${tail}`;
                }

            }
            else if (option === "COBOL") {
                url = `https://innersource.soprasteria.com/sab-at/business/${nameValue}/COBOL`;
            }
            else {
                url = `https://innersource.soprasteria.com/sab-at/business/${nameValue}/${option}`;
            }

            window.open(url, "_blank");
        });

        // COBOL sub-items (module prefix added dynamically)
        cobolSubs.forEach(sub => {

            const finalSub = `${nameValue}-${sub}`;

            let url = "";

            if (revisionValue !== "") {
                url = `https://innersource.soprasteria.com/sab-at/business/${nameValue}/cobol/${finalSub}/-/tree/${revisionValue}?ref_type=heads`;
            } else {
                url = `https://innersource.soprasteria.com/sab-at/business/${nameValue}/cobol/${finalSub}`;
            }

            window.open(url, "_blank");
        });

    });
});
</script>

</body>
</html>